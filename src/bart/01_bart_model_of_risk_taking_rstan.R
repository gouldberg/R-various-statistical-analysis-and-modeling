setwd("//media//kswada//MyFiles//R//bart//")

packages <- c("dplyr", "rstan")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)


# ------------------------------------------------------------------------------
# data:  BART (Balloon Analogue Risk Task)
#
#  - j:  j回目の試行　　k:　k回目の判断（膨らませるか、ポイント獲得するか）
#  - p:  風船の破裂確率（ここでは各試行で一定とする、オリジナル論文では各試行で上昇を仮定）
#  - gamma:  リスクテイキング傾向 (>0)
#  - omega:　最適なパンプ回数 = f(gamma, p), gamma が大きくなるにつれ、またp が小さくなるにつれ最適だと思うパンプ回数は大きくなり、よりリスクを追求する　（パンプ回数の上限は参加者には伝えない）
#  - beta:　行動の一貫性を表し (>0)、大きい値ほど最適なパンプ回数 omega 付近において、風船を膨らませるかどうかの判断確率が急激に変化
#  - theta:　実験参加者が風船を膨らませる確率 = f(beta, omega, k)
#  - 1 - theta:  実験参加者がポイントを獲得する確率
#  - d(jk):　j回目の試行におけるk回目の決定（1: ポイントを獲得　0:風船を膨らませる） ~ Bernoulli((1-theta))
# ------------------------------------------------------------------------------
Options <- matrix(c(
  11,11,12,14,10, 7, 8,
  11,11,12,12,10, 9,10,
  12,10,11,12, 9, 9,10,
  13,14,14,14,11, 8,10,
  12,12,11,12,12, 9, 7,
  10, 9,13,13,12, 8,11,
  10, 8, 9,13, 8, 8, 8,
  11,11, 9,15,11,10, 9,
  10,10,10,12,10, 9, 8,
  9,11,12,12, 8,12,10,
  11,12,10,14,10,11, 9,
  10,10,10,10,10, 9,10,
  10,10,11,13,11, 9, 8,
  11,11,11,11,10,10,10,
  12, 8,11,15, 9, 9, 9,
  13,11,11,13, 8, 9,12,
  11,11, 9,15,10, 7, 9,
  11, 9,11,13,11, 9, 9,
  9, 9, 9, 9, 9, 6, 9,
  12,11,10,15,11, 9,10,
  8, 8, 8, 8, 8, 8, 8,
  11,10,11,12,11,11, 9,
  9, 9, 9, 9, 9, 9, 9,
  10,10,10,10,10,10, 9,
  8, 8, 8, 8, 8, 8, 7,
  12,12,12,13,11, 8,10,
  11,11,11,12, 8, 7, 8,
  11,10,11,12,10,12,11,
  11,12,11,15,11,10, 9,
  11,11,13,15,10,10,10),30,7,byrow=T)

Npumps <- matrix(c(
  10,10,11,14, 9, 6, 7,
  10,10,12,12, 9, 8, 9,
  12, 9,10,12, 8, 8, 9,
  12,13,14,14,10, 7, 9,
  12,12,10,12,12, 8, 6,
  9, 8,12,13,11, 7,10,
  9, 7, 8,13, 7, 7, 7,
  10,10, 8,14,10, 9, 8,
  9, 9, 9,12, 9, 8, 7,
  8,10,11,12, 7,12, 9,
  10,11, 9,14, 9,10, 8,
  10,10,10,10, 9, 8,10,
  9, 9,10,13,10, 8, 7,
  11,11,11,11, 9, 9, 9,
  11, 7,10,14, 8, 8, 8,
  13,10,10,12, 7, 8,11,
  10,10, 8,15, 9, 6, 8,
  10, 8,10,13,10, 8, 8,
  9, 9, 0, 9, 9, 5, 8,
  11,10, 9,15,10, 8, 9,
  8, 8, 8, 8, 8, 8, 8,
  10, 9,10,12,10,10, 8,
  9, 9, 9, 9, 9, 9, 9,
  10,10, 9,10, 9, 9, 8,
  8, 8, 8, 8, 8, 8, 6,
  11,11,11,12,10, 7, 9,
  10,10,10,12, 7, 6, 7,
  10, 9,10,12, 9,12,10,
  10,11,10,15,10, 9, 8,
  10,10,12,15, 9, 9, 9),30,7,byrow=T)

Dis <- list(
  matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99),30,16,byrow=T),
  matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   1, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99),30,16,byrow=T),
  matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99),30,16,byrow=T),
  matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0,   1, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0,   1, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0,   0, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0,   0, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0,   0, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0,   0, -99),30,16,byrow=T),
  matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99),30,16,byrow=T),
  matrix(c(
    0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 1, -99, -99, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   1, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   1, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   1, -99, -99, -99, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   0,   0,   0, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0,   0,   0,   0,   1, -99, -99, -99, -99, -99, -99),30,16,byrow=T),
  matrix(c(
    0, 0, 0, 0, 0, 0, 0,   1, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 1, -99, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   0,    1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   1, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   1, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   0,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   1, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   0,    0,   1, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 1, -99, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   1, -99, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   0,    1, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   1, -99,  -99, -99, -99, -99, -99, -99,
    0, 0, 0, 0, 0, 0, 0,   0,   0,   1,  -99, -99, -99, -99, -99, -99),30,16,byrow=T))


# ------------------------------------------------------------------------------
# estimation for 1st person
# ------------------------------------------------------------------------------
ntrials <- 30
maxpump <- 16

p <- rep(.2, ntrials)
data01 <- list(ntrials=ntrials, p=p, maxpump=maxpump, options=Options[,1], d=Dis[[1]]) 

data01


# ----------
scr01 <- ".//stan//bart_01.stan"

# myinits <- list(list(gplus=1.2, beta=.5))
rt01 <- stanc(file = scr01, model_name = scr01, verbose=T)
sm01 <- stan_model(stanc_ret = rt01, verbose = FALSE)
sm01



# ----------
war <- 2500
ite <- 5000
see <- 1234
dig <- 3
cha <- 4

par01 <- c("gamma", "beta")
fit01 <- sampling(sm01, data=data01, iter=ite, chains=cha, warmup=war, seed=see, pars=par01)



# ----------
res01 <- summary(fit01)$summary
round(res01, 3)



# ----------
gamma_estS <- res01[grep("gamma", rownames(res01)),1]
beta_estS <- res01[grep("beta", rownames(res01)),1]


theta_jp <- function(k,beta,gamma,p){
  omega <- -gamma/(log(1-p))
  theta <- 1/(1+exp(beta*(k-omega)))
  return(theta)
}


k <- 1:25
par(mfrow=c(1,2))
hist(Npumps[,1], breaks=c(5:16), xlab="kth pomps", main="")
plot(k, theta_jp(k,beta=beta_estS,gamma=gamma_estS,p=0.15), type="b", pch="1", ylim=c(0,1), ylab="theta", las=1, lwd=2.5, xlab="kth pomps")
par(mfrow=c(1,1))


max(Npumps[,1])


# -->
# mean of gamma = 2.551:  high-risk taking



# ------------------------------------------------------------------------------
# estimation for 7 persons, multimodel data
# ------------------------------------------------------------------------------
data02 <- list(ntrials=ntrials, p=p, maxpump=maxpump, N=7, 
               options=t(Options[,c(1,2,3,4,5,6,7)]), d=structure(.Data=c(Dis[[1]],Dis[[2]],Dis[[3]],Dis[[4]],Dis[[5]],Dis[[6]],Dis[[7]]),.Dim=c(30,16,7)))


# ----------
scr02 <- ".//stan//bart_02.stan"
rt02 <- stanc(file = scr02, model_name = scr02, verbose=T)
sm02 <- stan_model(stanc_ret = rt02, verbose = FALSE)
sm02



# ----------
war <- 2500
ite <- 5000
see <- 1234
dig <- 3
cha <- 4

par02 <- c("gamma", "beta", "mu_g", "sigma_g", "mu_b", "sigma_b")
myinits02 <- rep(list(list(gamma=rep(1.5,7), beta=rep(1.0,7))),cha)
fit02 <- sampling(sm02, data=data02, iter=ite, chains=cha, warmup=war, seed=see, pars=par02, init=myinits02)



# ----------
res02 <- summary(fit02)$summary
round(res02, 3)



# ----------
gamma_est <- res02[grep("gamma", rownames(res02)),1]
beta_est <- res02[grep("beta", rownames(res02)),1]

k <- 1:25
plot(k,theta_jp(k,beta=beta_est[1],gamma=gamma_est[1],p=0.15),type="b",pch="1",ylim=c(0,1),ylab="theta",las=1,lwd=2.5);par(new=T)
plot(k,theta_jp(k,beta=beta_est[2],gamma=gamma_est[2],p=0.15),type="b",pch="2",ylim=c(0,1),ylab="theta",las=1,lwd=2.5);par(new=T)
plot(k,theta_jp(k,beta=beta_est[3],gamma=gamma_est[3],p=0.15),type="b",pch="3",ylim=c(0,1),ylab="theta",las=1,lwd=2.5);par(new=T)
plot(k,theta_jp(k,beta=beta_est[4],gamma=gamma_est[4],p=0.15),type="b",pch="4",ylim=c(0,1),ylab="theta",las=1,lwd=2.5);par(new=T)
plot(k,theta_jp(k,beta=beta_est[5],gamma=gamma_est[5],p=0.15),type="b",pch="5",ylim=c(0,1),ylab="theta",las=1,lwd=2.5);par(new=T)
plot(k,theta_jp(k,beta=beta_est[6],gamma=gamma_est[6],p=0.15),type="b",pch="6",ylim=c(0,1),ylab="theta",las=1,lwd=2.5);par(new=T)
plot(k,theta_jp(k,beta=beta_est[7],gamma=gamma_est[7],p=0.15),type="b",pch="7",ylim=c(0,1),ylab="theta",las=1,lwd=2.5)


# -->
# gamma[4] = 3.528, highest risk taker and gamma[7] = 2.128 is lowest risk taker
